# Discord リマインドbot 完璧な要件定義書

## 📋 プロジェクト概要

### 目的
Discord サーバー内でタスク管理とリマインド機能を提供する多機能Bot

### 対象ユーザー
- **管理者**: Bot設定・ユーザー管理
- **指示者**: タスク作成・管理権限
- **一般ユーザー**: タスク受託・実行

---

## 🔧 機能要件

### 1. ユーザー管理機能

#### 1.1 管理者機能
- `!セットアップ` - 初期設定実行
- `!管理者 追加 @ユーザー` - 管理者権限付与
- `!管理者 削除 @ユーザー` - 管理者権限剥奪
- `!管理者 一覧` - 管理者リスト表示

#### 1.2 指示者機能
- `!指示者 追加 @ユーザー` - 指示権限付与
- `!指示者 削除 @ユーザー` - 指示権限剥奪
- `!指示者 一覧` - 指示者リスト表示

#### 1.3 権限システム
- **管理者**: 全機能アクセス可能
- **指示者**: タスク作成・管理のみ
- **一般ユーザー**: タスク受託・完了のみ

---

### 2. タスク管理機能

#### 2.1 タスク作成
**フォーマット**: `@bot @ユーザー, 期日, タスク名`

**例**:
```
@リマインダくん @田中, 明日, 資料作成
@リマインダくん @佐藤 @鈴木, 12/25, プロジェクト完了
```

#### 2.2 期日フォーマット対応
- **相対日付**: `明日`, `今日`, `3日後`, `来週`, `来月`
- **絶対日付**: `12/25`, `2024/12/25`
- **曜日指定**: `金曜日`, `来週火曜日`
- **時間指定**: `2時間後`, `30分後`
- **日時指定**: `明日の15時`, `12/25の10:30`

#### 2.3 タスクステータス
- **pending** (🔴): 未受託
- **accepted** (🟡): 受託済み
- **completed** (🟢): 完了
- **abandoned** (⚫): 放棄
- **problem** (🟠): 問題発生

#### 2.4 インタラクティブUI
各タスクに以下のボタンを配置:
- ✅ **受託** - タスクを受け入れる
- ❌ **辞退** - タスクを断る
- 🏁 **完了** - タスクを完了する
- ⚠️ **問題** - 問題を報告する
- 🗑️ **放棄** - タスクを放棄する
- 🔄 **完了取消** - 完了を取り消す

---

### 3. 通知システム

#### 3.1 個人チャンネル
**自動作成**: オフ（自動作成しない）
**送信先チャンネル**: `to-{ユーザー名}`
**権限設定**: 本人・管理者・指示者のみアクセス
**タスク通知**: 新規タスク受信時は `to-{ユーザー名}` チャンネルに送信

#### 3.2 スレッド管理
**命名規則**: `{絵文字} {日時}-{タスク名}-{ステータス}`
- 🔴 2025/08/01 23:59-資料作成-pending
- 🟡 2025/08/01 23:59-資料作成-accepted
- 🟢 2025/08/01 23:59-資料作成-completed

#### 3.3 指示者通知
- **タスク作成時**: 作成完了通知
- **ステータス変更時**: 受託・完了・問題報告時
- **通知方法**: DM + 個人チャンネル + タスク管理チャンネル

#### 3.4 リマインダー機能
- **期日1時間前**: 自動リマインド送信
- **送信先**: 担当者の個人チャンネル + DM
- **重複防止**: 1回のみ送信

---

### 4. チャンネル管理

#### 4.1 チャンネル作成コマンド
- `!チャンネル作成` - タスク管理チャンネル作成
- `!個人チャンネル作成 @ユーザー` - 個人チャンネル作成

#### 4.2 自動チャンネル管理
- **存在確認**: チャンネルが無い場合は自動作成
- **権限設定**: 適切なユーザーのみアクセス可能
- **権限更新**: 既存チャンネルの権限も自動更新

---

### 5. 情報表示機能

#### 5.1 タスク一覧
- `!タスク一覧` - 自分のタスク表示
- `!タスク一覧 @ユーザー` - 指定ユーザーのタスク（管理者のみ）
- `!すべてのタスク` - 全タスク表示（管理者のみ）

#### 5.2 ステータス・ヘルプ
- `!ステータス` - Bot動作状況確認
- `!ヘルプ` - コマンド一覧・使用方法
- `!テスト` - Bot動作確認

---

### 6. データ管理

#### 6.1 データベース構造
```sql
-- 管理者テーブル
CREATE TABLE admins (
    user_id INTEGER PRIMARY KEY,
    guild_id INTEGER,
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 指示者テーブル
CREATE TABLE instructors (
    user_id INTEGER,
    guild_id INTEGER,
    target_users TEXT,
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id, guild_id)
);

-- タスクテーブル
CREATE TABLE tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    guild_id INTEGER,
    instructor_id INTEGER,
    assignee_id INTEGER,
    task_name TEXT,
    due_date TIMESTAMP,
    status TEXT DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    message_id INTEGER,
    channel_id INTEGER,
    reminder_sent INTEGER DEFAULT 0
);
```

#### 6.2 重複防止
- **同一タスク名**: 同じユーザーに同じタスク名は重複不可
- **同時実行**: コマンド実行中の重複防止

---

### 7. エラーハンドリング

#### 7.1 権限エラー
- 権限不足時の適切なエラーメッセージ
- 管理者への連絡案内

#### 7.2 入力エラー
- フォーマット違反時の修正案内
- 例文表示

#### 7.3 システムエラー
- Discord API制限対応
- データベースエラー処理
- 自動復旧機能

---

## 🛠️ 技術要件

### 8.1 使用技術
- **言語**: Python 3.8+
- **ライブラリ**: discord.py>=2.0.0
- **データベース**: SQLite3
- **ホスティング**: 24/7稼働対応

### 8.2 Discord設定
- **Intents**: message_content, members
- **Permissions**: メッセージ送信、チャンネル管理、ロール管理

### 8.3 環境変数
```bash
DISCORD_BOT_TOKEN=your_bot_token_here
```

---

## 🚀 運用要件

### 9.1 稼働要件
- **24/7運用**: 常時稼働
- **自動復旧**: クラッシュ時の自動再起動
- **ログ管理**: 詳細ログ出力

### 9.2 パフォーマンス
- **応答時間**: 3秒以内
- **同時処理**: 複数ユーザー対応
- **レート制限**: Discord API制限遵守

### 9.3 セキュリティ
- **トークン管理**: 環境変数での安全な管理
- **権限制御**: 最小権限の原則
- **データ保護**: 個人情報の適切な取り扱い

---

## 📈 拡張機能（将来実装予定）

### 10.1 高度な通知
- **週次レポート**: タスク完了率の自動レポート
- **期限超過警告**: 期限切れタスクの警告
- **進捗確認**: 定期的な進捗確認

### 10.2 分析機能
- **統計表示**: ユーザー別完了率
- **パフォーマンス分析**: タスク処理時間分析
- **レポート生成**: CSV/PDF出力

### 10.3 連携機能
- **カレンダー連携**: Google Calendar同期
- **外部API**: Slack/Teams連携
- **Webhook**: 外部システム通知

---

## 🛠️ セットアップ手順

### 1. 依存関係のインストール
```bash
pip install discord.py>=2.0.0
```

### 2. 環境変数の設定
```bash
export DISCORD_BOT_TOKEN="your_bot_token_here"
```

### 3. Bot起動
```bash
python3 mybot.py
```

### 4. 24/7稼働（nohup使用）
```bash
nohup python3 mybot.py > bot.log 2>&1 &
```

### 5. Discord設定
1. Botを招待
2. `!セットアップ` で初期設定
3. `!管理者 追加 @ユーザー` で管理者設定
4. `!チャンネル作成` でチャンネル作成

---

## 📝 使用例

### タスク作成
```
@リマインダくん @田中, 明日の15時, 会議資料作成
@リマインダくん @佐藤 @鈴木, 来週金曜日, プロジェクト完了
```

### 管理コマンド
```
!管理者 追加 @田中
!指示者 追加 @佐藤
!タスク一覧
!すべてのタスク
```

---

**この要件定義に基づいて、完全機能のDiscord リマインドBotが実装されています。** 
